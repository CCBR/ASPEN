<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=CCBR><link rel="shortcut icon" href=../img/favicon.ico><title>Running ASPEN - ASPEN</title><link rel=stylesheet href=../css/theme.css><link rel=stylesheet href=../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><link href=../css/custom.css rel=stylesheet><link href=../css/version-select.css rel=stylesheet><script>
        // Current page data
        var mkdocs_page_name = "Running ASPEN";
        var mkdocs_page_input_path = "deployment.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=.. class="icon icon-home"> ASPEN </a><div role=search> <form id=rtd-search-form class=wy-form action=../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=..>Background</a> </li> </ul> <ul> <li class=toctree-l1><a href=../introduction/ class="reference internal">Introduction to ATAC-seq</a> </li> </ul> <ul> <li class=toctree-l1><a href=../overview/ class="reference internal">Overview of ASPEN</a> </li> </ul> <ul class=current> <li class="toctree-l1 current"><a class="reference internal current" href=#>Running ASPEN</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#prerequisites>Prerequisites</a> </li> <li class=toctree-l2><a class="reference internal" href=#setting-up-the-environment>Setting Up the Environment</a> <ul> <li class=toctree-l3><a class="reference internal" href=#load-the-aspen-module-on-biowulf>Load the ASPEN Module on Biowulf</a> </li> <li class=toctree-l3><a class="reference internal" href=#create-a-sample-manifest>Create a Sample Manifest</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#running-the-aspen-pipeline>Running the ASPEN Pipeline</a> <ul> <li class=toctree-l3><a class="reference internal" href=#initialize-the-working-directory>Initialize the Working Directory</a> </li> <li class=toctree-l3><a class="reference internal" href=#dry-run-the-pipeline>Dry Run the Pipeline</a> </li> <li class=toctree-l3><a class="reference internal" href=#execute-the-pipeline>Execute the Pipeline</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#monitor-aspen-runs>Monitor ASPEN runs</a> </li> </ul> </li> </ul> <ul> <li class=toctree-l1><a href=../outputs/ class="reference internal">ASPEN Output</a> </li> </ul> <ul> <li class=toctree-l1><a href=../limitations/ class="reference internal">Limitations of ASPEN</a> </li> </ul> <ul> <li class=toctree-l1><a href=../communications/ class="reference internal">Communications</a> </li> </ul> <ul> <li class=toctree-l1><a href=../changelog/ class="reference internal">Change Log</a> </li> </ul> <ul> <li class=toctree-l1><a href=../contributing/ class="reference internal">Contributing to ASPEN</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=..>ASPEN</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=.. class="icon icon-home" aria-label=Docs></a></li> <li class="breadcrumb-item active">Running ASPEN</li> <li class=wy-breadcrumbs-aside> <a href=https://github.com/CCBR/ASPEN/edit/main/docs/deployment.md>Edit on CCBR/ASPEN</a> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h1 id=running-aspen>Running ASPEN<a class=headerlink href=#running-aspen title="Permanent link">&para;</a></h1> <p>To effectively run the ASPEN (ATAC-Seq PipEliNe) on the Biowulf High-Performance Computing (HPC) system, please follow the detailed user guide below:</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <ul> <li><strong>Biowulf Account:</strong> Ensure you have an active Biowulf account.</li> <li><strong>Data Preparation:</strong> Store your raw ATAC-Seq paired-end FASTQ files in a directory accessible from Biowulf.</li> </ul> <h2 id=setting-up-the-environment>Setting Up the Environment<a class=headerlink href=#setting-up-the-environment title="Permanent link">&para;</a></h2> <h3 id=load-the-aspen-module-on-biowulf>Load the ASPEN Module on Biowulf<a class=headerlink href=#load-the-aspen-module-on-biowulf title="Permanent link">&para;</a></h3> <p>To access ASPEN, load the <code>ccbrpipeliner</code> module:</p> <div class=highlight><pre><span></span><code>module<span class=w> </span>load<span class=w> </span>ccbrpipeliner/7
</code></pre></div> <p>This command adds aspen to your system's PATH, allowing you to execute pipeline commands directly.</p> <blockquote> <p><strong>Note</strong>: If you're operating outside of Biowulf, ensure that dependencies such as snakemake, python, and singularity are installed and accessible in your system's PATH.</p> </blockquote> <h3 id=create-a-sample-manifest>Create a Sample Manifest<a class=headerlink href=#create-a-sample-manifest title="Permanent link">&para;</a></h3> <p>ASPEN requires a sample manifest file (<code>samples.tsv</code>) to identify and organize your input data. This tab-separated file should include the following columns:</p> <ul> <li><code>replicateName</code>: Unique identifier for each replicate.</li> <li><code>sampleName</code>: Identifier for the sample; multiple replicates can share the same sample name.</li> <li><code>path_to_R1_fastq</code>: Absolute path to the Read 1 FASTQ file.</li> <li><code>path_to_R2_fastq</code>: Absolute path to the Read 2 FASTQ file (required for paired-end data).</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> </div> <p>Symlinks for R1 and R2 files will be created in the results directory, named as <replicatename>.R1.fastq.gz and <replicatename>.R2.fastq.gz, respectively. Therefore, original filenames do not need to be altered.</p> <div class="admonition note"> <p class=admonition-title>Note</p> </div> <p>The <code>replicateName</code> is used as a prefix for individual peak calls, while the <code>sampleName</code> serves as a prefix for consensus peak calls.</p> <div class="admonition note"> <p class=admonition-title>Note</p> </div> <p>For differential ATAC analysis, create a <code>contrasts.tsv</code> file with two columns (Group1 and Group2 ... aka Sample1 and Sample2, without headers) and place it in the output directory after initialization. Ensure each group/sample in the contrast has at least two replicates, as DESeq2 requires this for accurate contrast calculations.</p> <h2 id=running-the-aspen-pipeline>Running the ASPEN Pipeline<a class=headerlink href=#running-the-aspen-pipeline title="Permanent link">&para;</a></h2> <p>ASPEN operates through a series of modes to facilitate various stages of the analysis.</p> <h3 id=initialize-the-working-directory>Initialize the Working Directory<a class=headerlink href=#initialize-the-working-directory title="Permanent link">&para;</a></h3> <p>Begin by initializing your working directory, which will house configuration files and results. Replace <path_to_output_folder> with your desired output directory path:</p> <div class=highlight><pre><span></span><code>aspen<span class=w> </span>-m<span class=o>=</span>init<span class=w> </span>-w<span class=o>=</span>&lt;path_to_output_folder&gt;
</code></pre></div> <p>This command generates a config.yaml and a placeholder <code>samples.tsv</code> in the specified directory. Edit these files to reflect your experimental setup, replacing the placeholder <code>samples.tsv</code> with your prepared manifest. If performing differential analysis, include the <code>contrasts.tsv</code> file at this stage.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>To explore all possible options of the <code>aspen</code> command you can either run it without any arguments or run <code>aspen --help</code></p> </div> <p>Here is what help looks like: <div class=highlight><pre><span></span><code><span class=c1>##########################################################################################</span>

Welcome<span class=w> </span>to
____<span class=w> </span>____<span class=w> </span>___<span class=w>  </span>____<span class=w> </span>_<span class=w>  </span>_
<span class=p>|</span>__<span class=p>|</span><span class=w> </span><span class=o>[</span>__<span class=w>  </span><span class=p>|</span>__<span class=o>]</span><span class=w> </span><span class=p>|</span>___<span class=w> </span><span class=p>|</span><span class=se>\ </span><span class=p>|</span>
<span class=p>|</span><span class=w>  </span><span class=p>|</span><span class=w> </span>___<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w>    </span><span class=p>|</span>___<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\|</span><span class=w>    </span>v1.0.6

A_TAC_S_eq<span class=w> </span>A_nalysis<span class=w> </span>P_ip_E_li_N_e

<span class=c1>##########################################################################################</span>

This<span class=w> </span>pipeline<span class=w> </span>was<span class=w> </span>built<span class=w> </span>by<span class=w> </span>CCBR<span class=w> </span><span class=o>(</span>https://bioinformatics.ccr.cancer.gov/ccbr<span class=o>)</span>
Please<span class=w> </span>contact<span class=w> </span>Vishal<span class=w> </span>Koparde<span class=w> </span><span class=k>for</span><span class=w> </span>comments/questions<span class=w> </span><span class=o>(</span>vishal.koparde@nih.gov<span class=o>)</span>

<span class=c1>##########################################################################################</span>

Here<span class=w> </span>is<span class=w> </span>a<span class=w> </span>list<span class=w> </span>of<span class=w> </span>genome<span class=w> </span>supported<span class=w> </span>by<span class=w> </span>aspen:

<span class=w>  </span>*<span class=w> </span>hg19<span class=w>          </span><span class=o>[</span>Human<span class=o>]</span>
<span class=w>  </span>*<span class=w> </span>hg38<span class=w>          </span><span class=o>[</span>Human<span class=o>]</span>
<span class=w>  </span>*<span class=w> </span>mm10<span class=w>          </span><span class=o>[</span>Mouse<span class=o>]</span>
<span class=w>  </span>*<span class=w> </span>mmul10<span class=w>        </span><span class=o>[</span>Macaca<span class=w> </span>mulatta<span class=o>(</span>Rhesus<span class=w> </span>monkey<span class=o>)</span><span class=w> </span>or<span class=w> </span>rheMac10<span class=o>]</span>
<span class=w>  </span>*<span class=w> </span>bosTau9<span class=w>       </span><span class=o>[</span>Bos<span class=w> </span>taurus<span class=o>(</span>cattle<span class=o>)]</span>

aspen<span class=w> </span>calls<span class=w> </span>peaks<span class=w> </span>using<span class=w> </span>the<span class=w> </span>following<span class=w> </span>tools:

<span class=w> </span>*<span class=w> </span>MACS2
<span class=w> </span>*<span class=w> </span>Genrich<span class=w>        </span><span class=o>[</span>RECOMMENDED<span class=w> </span>FOR<span class=w> </span>USE<span class=o>]</span>

USAGE:
<span class=w>  </span>bash<span class=w> </span>/gpfs/gsfs10/users/CCBR_Pipeliner/Pipelines/ASPEN/.v1.0.6/aspen<span class=w> </span>-w/--workdir<span class=o>=</span>&lt;WORKDIR&gt;<span class=w> </span>-m/--runmode<span class=o>=</span>&lt;RUNMODE&gt;

Required<span class=w> </span>Arguments:
<span class=m>1</span>.<span class=w>  </span>WORKDIR<span class=w>     </span>:<span class=w> </span><span class=o>[</span>Type:<span class=w> </span>String<span class=o>]</span>:<span class=w> </span>Absolute<span class=w> </span>or<span class=w> </span>relative<span class=w> </span>path<span class=w> </span>to<span class=w> </span>the<span class=w> </span>output<span class=w> </span>folder<span class=w> </span>with<span class=w> </span>write<span class=w> </span>permissions.

<span class=m>2</span>.<span class=w>  </span>RUNMODE<span class=w>     </span>:<span class=w> </span><span class=o>[</span>Type:<span class=w> </span>String<span class=o>]</span><span class=w> </span>Valid<span class=w> </span>options:
<span class=w>    </span>*<span class=w> </span>init<span class=w>      </span>:<span class=w> </span>initialize<span class=w> </span>workdir
<span class=w>    </span>*<span class=w> </span>dryrun<span class=w>    </span>:<span class=w> </span>dry<span class=w> </span>run<span class=w> </span>snakemake<span class=w> </span>to<span class=w> </span>generate<span class=w> </span>DAG
<span class=w>    </span>*<span class=w> </span>run<span class=w>       </span>:<span class=w> </span>run<span class=w> </span>with<span class=w> </span>slurm
<span class=w>    </span>*<span class=w> </span>runlocal<span class=w>  </span>:<span class=w> </span>run<span class=w> </span>without<span class=w> </span>submitting<span class=w> </span>to<span class=w> </span>sbatch
<span class=w>    </span>ADVANCED<span class=w> </span>RUNMODES<span class=w> </span><span class=o>(</span>use<span class=w> </span>with<span class=w> </span>caution!!<span class=o>)</span>
<span class=w>    </span>*<span class=w> </span>unlock<span class=w>    </span>:<span class=w> </span>unlock<span class=w> </span>WORKDIR<span class=w> </span><span class=k>if</span><span class=w> </span>locked<span class=w> </span>by<span class=w> </span>snakemake<span class=w> </span>NEVER<span class=w> </span>UNLOCK<span class=w> </span>WORKDIR<span class=w> </span>WHERE<span class=w> </span>PIPELINE<span class=w> </span>IS<span class=w> </span>CURRENTLY<span class=w> </span>RUNNING!
<span class=w>    </span>*<span class=w> </span>reconfig<span class=w>  </span>:<span class=w> </span>recreate<span class=w> </span>config<span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>WORKDIR<span class=w> </span><span class=o>(</span>debugging<span class=w> </span>option<span class=o>)</span><span class=w> </span>EDITS<span class=w> </span>TO<span class=w> </span>config.yaml<span class=w> </span>WILL<span class=w> </span>BE<span class=w> </span>LOST!
<span class=w>    </span>*<span class=w> </span>reset<span class=w>     </span>:<span class=w> </span>DELETE<span class=w> </span>workdir<span class=w> </span>dir<span class=w> </span>and<span class=w> </span>re-init<span class=w> </span>it<span class=w> </span><span class=o>(</span>debugging<span class=w> </span>option<span class=o>)</span><span class=w> </span>EDITS<span class=w> </span>TO<span class=w> </span>ALL<span class=w> </span>FILES<span class=w> </span>IN<span class=w> </span>WORKDIR<span class=w> </span>WILL<span class=w> </span>BE<span class=w> </span>LOST!
<span class=w>    </span>*<span class=w> </span>printbinds:<span class=w> </span>print<span class=w> </span>singularity<span class=w> </span>binds<span class=w> </span><span class=o>(</span>paths<span class=o>)</span>
<span class=w>    </span>*<span class=w> </span><span class=nb>local</span><span class=w>     </span>:<span class=w> </span>same<span class=w> </span>as<span class=w> </span>runlocal

Optional<span class=w> </span>Arguments:

--genome<span class=p>|</span>-g<span class=w>     </span>:<span class=w> </span>genome<span class=w> </span>eg.<span class=w> </span>hg38
--manifest<span class=p>|</span>-s<span class=w>   </span>:<span class=w> </span>absolute<span class=w> </span>path<span class=w> </span>to<span class=w> </span>samples.tsv.<span class=w> </span>This<span class=w> </span>will<span class=w> </span>be<span class=w> </span>copied<span class=w> </span>to<span class=w> </span>output<span class=w> </span>folder<span class=w>                    </span><span class=o>(</span>--runmode<span class=o>=</span>init<span class=w> </span>only<span class=o>)</span>
--help<span class=p>|</span>-h<span class=w>       </span>:<span class=w> </span>print<span class=w> </span>this<span class=w> </span><span class=nb>help</span>

Example<span class=w> </span>commands:
<span class=w>  </span>bash<span class=w> </span>/gpfs/gsfs10/users/CCBR_Pipeliner/Pipelines/ASPEN/.v1.0.6/aspen<span class=w> </span>-w<span class=o>=</span>/my/output/folder<span class=w> </span>-m<span class=o>=</span>init
<span class=w>  </span>bash<span class=w> </span>/gpfs/gsfs10/users/CCBR_Pipeliner/Pipelines/ASPEN/.v1.0.6/aspen<span class=w> </span>-w<span class=o>=</span>/my/output/folder<span class=w> </span>-m<span class=o>=</span>dryrun
<span class=w>  </span>bash<span class=w> </span>/gpfs/gsfs10/users/CCBR_Pipeliner/Pipelines/ASPEN/.v1.0.6/aspen<span class=w> </span>-w<span class=o>=</span>/my/output/folder<span class=w> </span>-m<span class=o>=</span>run

<span class=c1>##########################################################################################</span>

VersionInfo:
<span class=w>  </span>python<span class=w>          </span>:<span class=w> </span>python/3.10
<span class=w>  </span>snakemake<span class=w>       </span>:<span class=w> </span>snakemake
<span class=w>  </span>pipeline_home<span class=w>   </span>:<span class=w> </span>/gpfs/gsfs10/users/CCBR_Pipeliner/Pipelines/ASPEN/.v1.0.6
<span class=w>  </span>git<span class=w> </span>commit/tag<span class=w>  </span>:<span class=w> </span>f4366158ad972bc667422dcd4783bd69fa041556<span class=w>    </span>v1.0.6
<span class=w>  </span>aspen_version<span class=w>   </span>:<span class=w> </span>v1.0.6

<span class=c1>##########################################################################################</span>
</code></pre></div></p> <h3 id=dry-run-the-pipeline>Dry Run the Pipeline<a class=headerlink href=#dry-run-the-pipeline title="Permanent link">&para;</a></h3> <p>Before executing the full analysis, perform a dry run to visualize the workflow and identify potential issues:</p> <p><div class=highlight><pre><span></span><code>aspen<span class=w> </span>-m<span class=o>=</span>dryrun<span class=w> </span>-w<span class=o>=</span>&lt;path_to_output_folder&gt;
</code></pre></div> This step outlines the sequence of tasks (Directed Acyclic Graph - DAG) without actual execution, allowing you to verify the planned operations.</p> <h3 id=execute-the-pipeline>Execute the Pipeline<a class=headerlink href=#execute-the-pipeline title="Permanent link">&para;</a></h3> <p>If the dry run output is satisfactory, proceed to run the pipeline:</p> <p><div class=highlight><pre><span></span><code>aspen<span class=w> </span>-m<span class=o>=</span>run<span class=w> </span>-w<span class=o>=</span>&lt;path_to_output_folder&gt;
</code></pre></div> This command submits a master job to the Slurm workload manager, which orchestrates the entire analysis workflow, managing job submissions and monitoring progress.</p> <ul> <li>Optional Argument:</li> </ul> <p><code>--singcache</code> or <code>-c</code>: Specify a Singularity cache directory. The default is <code>/data/${USER}/.singularity</code> if available; otherwise, it defaults to <code>${WORKDIR}/snakemake/.singularity</code>.</p> <p><strong>Example Command</strong>:</p> <p><div class=highlight><pre><span></span><code>aspen<span class=w> </span>-m<span class=o>=</span>run<span class=w> </span>-w<span class=o>=</span>/my/output/folder<span class=w> </span>-c<span class=w> </span>/data/<span class=si>${</span><span class=nv>USER</span><span class=si>}</span>/.singularity
</code></pre></div> This command runs the pipeline with the specified working directory and Singularity cache directory.</p> <h2 id=monitor-aspen-runs>Monitor ASPEN runs<a class=headerlink href=#monitor-aspen-runs title="Permanent link">&para;</a></h2> <p>To monitor the status of your ASPEN pipeline and its associated jobs on a Slurm-managed system, you can utilize the squeue and scontrol commands. The squeue command provides information about jobs in the scheduling queue, while scontrol offers detailed insights into specific jobs.</p> <p>To view all your active and pending jobs, execute:</p> <p><div class=highlight><pre><span></span><code>squeue<span class=w> </span>-u<span class=w> </span><span class=nv>$USER</span>
</code></pre></div> This command lists all jobs submitted by your user account, displaying details such as job IDs, partitions, job names, user names, job states, and the nodes allocated.</p> <p>For more granular information about a specific job, including its child jobs spawned by ASPEN, use the scontrol command:</p> <p><div class=highlight><pre><span></span><code>scontrol<span class=w> </span>show<span class=w> </span>job<span class=w> </span>&lt;jobid&gt;
</code></pre></div> Replace <jobid> with the specific Job ID of interest. This will provide comprehensive details about the job's configuration and status, aiding in effective monitoring and management of your ASPEN pipeline processes.</p> </div> </div><script async src="https://www.googletagmanager.com/gtag/js?id=G-D3SL9V30KL"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D3SL9V30KL'); // Replace with your tracking ID
</script> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span> <a href=https://github.com/CCBR/ASPEN class="fa fa-code-fork" style="color: #fcfcfc"> CCBR/ASPEN</a> </span> <span><a href=../overview/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../outputs/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../js/jquery-3.6.0.min.js></script> <script>var base_url = "..";</script> <script src=../js/theme_extra.js></script> <script src=../js/theme.js></script> <script src=../js/custom.js></script> <script src=../search/main.js></script> <script src=../js/version-select.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 